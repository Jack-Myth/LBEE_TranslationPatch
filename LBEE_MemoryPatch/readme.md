# 内存补丁运行方式

首先在visual studio中将代码编译成32位PE程序（x86），然后将编译产物重命名为``LITBUS_WIN32.exe``，和``input.txt``文件一起复制到游戏运行目录，将原来的``LITBUS_WIN32.exe``命名为``LITBUS_WIN32.exe.bak``。这样就可以在steam的库中运行游戏并且自动加载内存补丁。

steam库启动的时候是直接启动``LITBUS_WIN32.exe``的，因此没有办法将补丁命名为“-CHS”等带后缀的结构，于是补丁采用了以下的方式实现了自动注入内存：

1. 用户通过steam运行的``LITBUS_WIN32.exe``是内存补丁程序。
2. 内存补丁将自身复制为``LBEE_CHSMemoryPatch.exe``，然后带参数启动这个进程，本进程结束。
3. 将``LITBUS_WIN32.exe.bak``复制为``LITBUS_WIN32.exe``，启动真正的游戏程序并获取模块基地址，根据``input.txt``记录的数据将中文字符串写入内存。
4. 等待游戏程序进程结束，内存补丁程序再将自身复制为``LITBUS_WIN32.exe``。

``input.txt``映射文件的输入格式所有数字均为16进制的形式）
* 首先是一个数字，代表词条数目
* 每个词条占三行，第一行有一个数字，为词条所在**PE文件偏移**
* 第二行为英文原文，用来计算最大字节长度
* 第三行为翻译中文，要确保中文的utf-8字节数小于等于英文的utf-8字节数，否则本词条将不进行处理

目前只做了菜单的部分文本以及部分询问文本。字符串的寻找没有什么规律，只能手动去找……

可以使用``LBEE_CHSMemoryPatch.exe --check``检验文本是否有问题。